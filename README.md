# YForm Lang Fields

Mehrsprachige Felder f√ºr REDAXO YForm - Unterst√ºtzt einfache Text-, Textarea- und Media-Felder mit CKEditor 5 Integration.

## ‚ú® Features

- **3 Feldtypen**: Text, Textarea und Media mit vollst√§ndiger Mehrsprachigkeit
- **CKEditor 5 Integration**: GPL-konforme Editor-Integration f√ºr Textareas
- **REDAXO Mediapool**: Nahtlose Integration mit dem REDAXO Media-Widget
- **Optionale Textfelder**: Zus√§tzliche Textfelder f√ºr Media (Alt-Text, Captions, etc.)
- **Kompaktes MBlock-Design**: Moderne Panel-basierte UI mit Delete-Buttons im Header
- **Dynamisches Hinzuf√ºgen/Entfernen**: Sprachen k√∂nnen jederzeit hinzugef√ºgt oder entfernt werden
- **Beschreibungstexte**: Optionale Hilfstexte f√ºr alle Feldtypen
- **Responsive Design**: Optimiert f√ºr Desktop und Mobile

## üì¶ Installation

1. Addon in `/redaxo/src/addons/yform_lang_fields/` entpacken
2. Im REDAXO-Backend unter "Addons" installieren und aktivieren
3. Sicherstellen, dass YForm (>= 4.0) installiert ist
4. Mindestens eine Sprache in REDAXO konfiguriert haben

## üîß Anforderungen

- REDAXO >= 5.15
- YForm >= 4.0
- Mediapool Addon (f√ºr Media-Felder)
- Font Awesome 6 (f√ºr Icons)
- Mindestens eine konfigurierte Sprache

## üìù Feldtypen

### 1. Lang Text (`lang_text`)

Mehrsprachiges einzeiliges Textfeld.

```php
$yform->setValueField('lang_text', [
    'name' => 'title',
    'label' => 'Titel',
    'description' => 'Der Haupttitel der Seite'
]);
```

### 2. Lang Textarea (`lang_textarea`)

Mehrsprachiges mehrzeiliges Textfeld mit optionalem CKEditor 5.

**Ohne Editor:**
```php
$yform->setValueField('lang_textarea', [
    'name' => 'description',
    'label' => 'Beschreibung',
    'rows' => 5,
    'description' => 'Kurze Beschreibung'
]);
```

**Mit CKEditor 5:**
```php
$yform->setValueField('lang_textarea', [
    'name' => 'content',
    'label' => 'Inhalt',
    'editor' => true,
    'rows' => 10,
    'attributes' => json_encode(['class' => 'cke5-editor'])
]);
```

### 3. Lang Media (`lang_media`)

Mehrsprachiges Media-Feld mit REDAXO Mediapool-Integration.

**Einfaches Media-Feld:**
```php
$yform->setValueField('lang_media', [
    'name' => 'image',
    'label' => 'Bild',
    'preview' => true,
    'types' => 'jpg,png,gif',
    'category' => 1
]);
```

**Media mit Textfeld (Alt-Text, Caption, etc.):**
```php
$yform->setValueField('lang_media', [
    'name' => 'hero_image',
    'label' => 'Hero Bild',
    'preview' => true,
    'with_text' => true,
    'text_label' => 'Bildunterschrift',
    'description' => 'Hauptbild f√ºr die Startseite'
]);
```

## üéØ Verwendung

### Im Tablemanager

1. Neue Spalte erstellen
2. Feldtyp w√§hlen: `lang_text`, `lang_textarea` oder `lang_media`
3. Parameter konfigurieren (siehe unten)
4. Speichern

### In YForm-Formularen

```php
$yform = new rex_yform();
$yform->setObjectparams('form_name', 'my_form');

// Text-Feld
$yform->setValueField('lang_text', [
    'name' => 'title',
    'label' => 'Titel',
    'description' => 'Der Seitentitel'
]);

// Textarea mit CKEditor
$yform->setValueField('lang_textarea', [
    'name' => 'content',
    'label' => 'Inhalt',
    'editor' => true
]);

// Media mit Textfeld
$yform->setValueField('lang_media', [
    'name' => 'image',
    'label' => 'Bild',
    'with_text' => true,
    'text_label' => 'Alt-Text'
]);
```

## ‚öôÔ∏è Parameter

### Allgemeine Parameter (alle Feldtypen)

| Parameter | Typ | Standard | Beschreibung |
|-----------|-----|----------|--------------|
| `name` | string | - | Feldname (Pflicht) |
| `label` | string | - | Feldbezeichnung (Pflicht) |
| `description` | string | '' | Optionaler Hilfstext |
| `notice` | string | '' | Hinweistext |
| `required` | bool | false | Pflichtfeld |

### Lang Text Parameter

| Parameter | Typ | Standard | Beschreibung |
|-----------|-----|----------|--------------|
| `attributes` | json | '' | Zus√§tzliche HTML-Attribute |

### Lang Textarea Parameter

| Parameter | Typ | Standard | Beschreibung |
|-----------|-----|----------|--------------|
| `rows` | int | 5 | Anzahl der Zeilen |
| `editor` | bool | false | CKEditor 5 aktivieren |
| `attributes` | json | '' | Zus√§tzliche HTML-Attribute |

### Lang Media Parameter

| Parameter | Typ | Standard | Beschreibung |
|-----------|-----|----------|--------------|
| `types` | string | '' | Erlaubte Dateitypen (z.B. 'jpg,png,gif') |
| `category` | int | '' | Mediapool-Kategorie ID |
| `preview` | bool | true | Bildvorschau anzeigen |
| `with_text` | bool | false | Zus√§tzliches Textfeld aktivieren |
| `text_label` | string | 'Beschreibung' | Label f√ºr Textfeld |

## üìö Beispiele

### Vollst√§ndiges Beispiel: Mehrsprachiger Blog-Artikel

```php
$yform = new rex_yform();
$yform->setObjectparams('form_name', 'blog_article');

// Titel
$yform->setValueField('lang_text', [
    'name' => 'title',
    'label' => 'Titel',
    'description' => 'Der Artikeltitel',
    'required' => true
]);

// Teaser
$yform->setValueField('lang_textarea', [
    'name' => 'teaser',
    'label' => 'Teaser',
    'rows' => 3,
    'description' => 'Kurze Zusammenfassung'
]);

// Hauptinhalt mit Editor
$yform->setValueField('lang_textarea', [
    'name' => 'content',
    'label' => 'Inhalt',
    'editor' => true,
    'rows' => 15
]);

// Titelbild mit Alt-Text
$yform->setValueField('lang_media', [
    'name' => 'featured_image',
    'label' => 'Beitragsbild',
    'preview' => true,
    'with_text' => true,
    'text_label' => 'Alt-Text',
    'types' => 'jpg,png,webp',
    'description' => 'Hauptbild des Artikels'
]);
```

### Daten auslesen

#### Mit Standard YOrm Dataset

```php
// Rohdaten (JSON-String)
$titleJson = $dataset->getValue('title');
// Gibt zur√ºck: '[{"clang_id":1,"value":"Deutscher Titel"},{"clang_id":2,"value":"English Title"}]'

// Als Array mit LangHelper
$titleArray = \KLXM\YformLangFields\LangHelper::normalizeLanguageData($titleJson);
// Gibt zur√ºck: [
//     ['clang_id' => 1, 'value' => 'Deutscher Titel'],
//     ['clang_id' => 2, 'value' => 'English Title']
// ]

// Wert f√ºr spezifische Sprache
$germanTitle = \KLXM\YformLangFields\LangHelper::getValueForLanguage($titleJson, 1);
// Gibt zur√ºck: 'Deutscher Titel'
```

#### Mit LangDataset (Automatische Array-Konvertierung) ‚≠ê

```php
use KLXM\YformLangFields\LangDataset;

class BlogArticle extends LangDataset
{
    public static function tableName()
    {
        return 'rex_blog_article'; // Deine YForm-Tabelle
    }
}

// Jetzt automatisch als Array!
$article = BlogArticle::get(1);
$titleArray = $article->getValue('title');
// Gibt zur√ºck: [
//     ['clang_id' => 1, 'value' => 'Deutscher Titel'],
//     ['clang_id' => 2, 'value' => 'English Title']
// ]

// Convenience-Methoden
$currentTitle = $article->getLang('title'); // Aktuelle Sprache
$germanTitle = $article->getLangValue('title', 1); // Spezifische Sprache
$allTitles = $article->getAllLangValues('title'); // [1 => 'Deutscher Titel', 2 => 'English Title']

// Wert setzen
$article->setLangValue('title', 1, 'Neuer Titel');
$article->save();

// Raw JSON wenn n√∂tig
$titleJson = $article->getRawValue('title');
```

## üóÑÔ∏è Datenstruktur

### Einfache Felder (Text, Textarea)

Daten werden als JSON-Array gespeichert:

```json
[
    {"clang_id": 1, "value": "Deutscher Text"},
    {"clang_id": 2, "value": "English text"}
]
```

### Media-Felder ohne Textfeld

```json
[
    {"clang_id": 1, "value": "bild.jpg"},
    {"clang_id": 2, "value": "image.jpg"}
]
```

### Media-Felder mit Textfeld

```json
[
    {
        "clang_id": 1,
        "value": {
            "media": "bild.jpg",
            "text": "Bildbeschreibung"
        }
    },
    {
        "clang_id": 2,
        "value": {
            "media": "image.jpg",
            "text": "Image description"
        }
    }
]
```

## üé® Styling & UI

### Kompaktes Panel-Design

Das Addon verwendet ein modernes, kompaktes Panel-Layout im MBlock-Stil:

- **Panel-Header**: Flaggen-Symbol, Sprachname und Delete-Button (oben rechts)
- **Panel-Body**: Feld-Content ohne zus√§tzliche Wrapper
- **Halbtransparenter Hintergrund**: 60% wei√üer Hintergrund f√ºr bessere Lesbarkeit
- **Responsive**: Optimiert f√ºr alle Bildschirmgr√∂√üen

### Anpassungen

CSS-Anpassungen k√∂nnen in `/assets/lang-fields.css` vorgenommen werden:

```css
/* Wrapper-Hintergrund √§ndern */
.yform-lang-field {
    background-color: rgba(255, 255, 255, 0.8); /* 80% statt 60% */
}

/* Panel-Farben anpassen */
.lang-field-item.panel {
    border-color: #0066cc;
}
```

## üîß Entwicklung

### Dateistruktur

```
yform_lang_fields/
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ lang-fields.css       # Styling
‚îÇ   ‚îî‚îÄ‚îÄ lang-fields.js         # JavaScript-Funktionalit√§t
‚îú‚îÄ‚îÄ lang/
‚îÇ   ‚îú‚îÄ‚îÄ de_de.lang            # Deutsche √úbersetzungen
‚îÇ   ‚îî‚îÄ‚îÄ en_gb.lang            # Englische √úbersetzungen
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ LangHelper.php        # Helper-Klasse
‚îÇ   ‚îú‚îÄ‚îÄ rex_yform_value_lang_text.php
‚îÇ   ‚îú‚îÄ‚îÄ rex_yform_value_lang_textarea.php
‚îÇ   ‚îî‚îÄ‚îÄ rex_yform_value_lang_media.php
‚îú‚îÄ‚îÄ ytemplates/
‚îÇ   ‚îî‚îÄ‚îÄ bootstrap/
‚îÇ       ‚îî‚îÄ‚îÄ value.lang_field.tpl.php  # Haupt-Template
‚îú‚îÄ‚îÄ boot.php                  # Addon-Bootstrap
‚îú‚îÄ‚îÄ package.yml              # Addon-Konfiguration
‚îî‚îÄ‚îÄ README.md               # Diese Datei
```

### CKEditor 5 Integration

Das Addon verwendet die GPL-Version von CKEditor 5 mit dem "ck"-Pr√§fix f√ºr IDs:

```javascript
// Automatische Initialisierung
initCKE5ForNewField: function($field) {
    var $textarea = $field.find('.cke5-editor');
    if ($textarea.length && typeof ClassicEditor !== 'undefined') {
        var editorId = 'ck' + $textarea.attr('id'); // GPL-konform
        ClassicEditor.create(document.getElementById(editorId))
            .catch(error => console.error(error));
    }
}
```

### Media Widget Integration

Das Addon nutzt die REDAXO Media-Widget-Funktionen:

```javascript
// Numerische IDs f√ºr Media-Widgets
static $widgetCounter = 0;
$widgetCounter++;
$widgetId = $widgetCounter;

// Widget √∂ffnen
openREXMedia(<?= $widgetId ?>, '<?= $mediaParams ?>');

// Widget l√∂schen
deleteREXMedia(<?= $widgetId ?>);
```

### Event-System

```javascript
// Sprache hinzuf√ºgen
$(document).on('click', '.btn-add-lang-field', function(e) {
    e.preventDefault();
    YformLangFields.addLanguageField($(this));
});

// Sprache entfernen
$(document).on('click', '.btn-remove-lang-field', function(e) {
    e.preventDefault();
    YformLangFields.removeLanguageField($(this));
});
```

## üêõ Troubleshooting

### CKEditor wird nicht geladen

- Stelle sicher, dass CKEditor 5 im Backend geladen wird
- Pr√ºfe die Browser-Konsole auf JavaScript-Fehler
- Verwende das "ck"-Pr√§fix f√ºr Editor-IDs (GPL-konform)

### Media-Widget funktioniert nicht

- Pr√ºfe, ob das Mediapool-Addon installiert ist
- Stelle sicher, dass numerische IDs verwendet werden (keine Strings)
- √úberpr√ºfe die Browser-Konsole auf Fehler

### Sprachen werden nicht angezeigt

- Mindestens eine Sprache muss in REDAXO konfiguriert sein
- Pr√ºfe die Sprachkonfiguration unter System > Sprachen

### Delete-Button reagiert nicht

- Stelle sicher, dass JavaScript geladen wird
- Pr√ºfe auf CSS z-index Konflikte
- √úberpr√ºfe die Browser-Konsole auf Fehler

## üìÑ Lizenz

MIT License

## üë§ Author

**KLXM Crossmedia / Thomas Skerbis**  
Website: [https://klxm.de](https://klxm.de)

## ü§ù Credits

Mit Unterst√ºtzung von **GitHub Copilot** - KI-gest√ºtzter Code-Assistent f√ºr schnellere Entwicklung und beste Praktiken.

## üîó Links

- [REDAXO](https://redaxo.org/)
- [YForm](https://github.com/yakamara/redaxo_yform)
- [CKEditor 5](https://ckeditor.com/)

---

**Version**: 1.0.0  
**Letztes Update**: Oktober 2025